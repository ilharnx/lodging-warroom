generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Trip {
  id          String    @id @default(cuid())
  name        String
  destination String
  centerLat   Float
  centerLng   Float
  adults      Int       @default(4)
  kids        Int       @default(2)
  nights      Int?
  checkIn     DateTime?
  checkOut    DateTime?
  listings    Listing[]
  createdAt   DateTime  @default(now())
}

model Listing {
  id             String    @id @default(cuid())
  tripId         String
  trip           Trip      @relation(fields: [tripId], references: [id], onDelete: Cascade)

  url            String
  source         String
  externalId     String?

  name           String
  description    String?
  totalCost      Float?
  perNight       Float?
  cleaningFee    Float?
  serviceFee     Float?
  taxes          Float?
  currency       String    @default("USD")

  address        String?
  neighborhood   String?
  lat            Float
  lng            Float

  bedrooms       Int?
  beds           String?
  bathrooms      Float?
  bathroomNotes  String?
  kitchen        String?
  kitchenDetails String?

  photos         Photo[]
  amenities      String?

  kidFriendly    Boolean   @default(false)
  kidNotes       String?
  beachType      String?
  beachDistance   String?

  rating         Float?
  reviewCount    Int?

  votes          Vote[]
  comments       Comment[]
  addedBy        String?

  scrapeStatus   String    @default("pending")
  scrapeError    String?
  lastScraped    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Photo {
  id        String  @id @default(cuid())
  listingId String
  listing   Listing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  url       String
  category  String?
  caption   String?
  sortOrder Int     @default(0)
}

model Vote {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  userName  String
  value     Int
  createdAt DateTime @default(now())

  @@unique([listingId, userName])
}

model Comment {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  userName  String
  text      String
  createdAt DateTime @default(now())
}
