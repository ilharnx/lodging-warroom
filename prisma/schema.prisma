generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Trip {
  id            String    @id @default(cuid())
  name          String
  destination   String
  centerLat     Float
  centerLng     Float
  adults        Int       @default(4)
  kids          Int       @default(2)
  nights        Int?
  checkIn       DateTime?
  checkOut      DateTime?
  preferences   Json?
  coverPhotoUrl String?
  coverPhotoAttribution String?
  listings      Listing[]
  createdAt     DateTime  @default(now())
}

model Listing {
  id             String    @id @default(cuid())
  tripId         String
  trip           Trip      @relation(fields: [tripId], references: [id], onDelete: Cascade)

  url            String
  source         String
  externalId     String?

  name           String
  description    String?   @db.Text
  totalCost      Float?
  perNight       Float?
  cleaningFee    Float?
  serviceFee     Float?
  taxes          Float?
  currency       String    @default("USD")

  address        String?
  neighborhood   String?
  lat            Float
  lng            Float

  bedrooms       Int?
  beds           Json?
  bathrooms      Float?
  bathroomNotes  String?   @db.Text
  kitchen        String?
  kitchenDetails String?   @db.Text

  photos         Photo[]
  amenities      Json?

  kidFriendly    Boolean   @default(false)
  kidNotes       String?   @db.Text
  beachType      String?
  beachDistance   String?

  rating         Float?
  reviewCount    Int?

  votes          Vote[]
  comments       Comment[]
  addedBy        String?

  aiFitAssessment Json?

  scrapeStatus   String    @default("pending")
  scrapeError    String?   @db.Text
  lastScraped    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Photo {
  id        String  @id @default(cuid())
  listingId String
  listing   Listing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  url       String
  category  String?
  caption   String? @db.Text
  sortOrder Int     @default(0)
}

enum ReactionType {
  fire
  love
  think
  pass
}

model Vote {
  id           String       @id @default(cuid())
  listingId    String
  listing      Listing      @relation(fields: [listingId], references: [id], onDelete: Cascade)
  userName     String
  value        Int          @default(0)
  reactionType ReactionType @default(fire)
  createdAt    DateTime     @default(now())

  @@unique([listingId, userName])
}

model Comment {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  userName  String
  text      String   @db.Text
  createdAt DateTime @default(now())
}
